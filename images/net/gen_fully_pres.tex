\input{img/cube.tex}

\begin{tikzpicture}[scale=0.5]%, every node/.style={transform shape}]
\newcommand{\Boxcolor}{\Thesiscolorbright}
\newcommand{\Linecolor}{black}
\newcommand{\halve}{0.3}

% define values
\pgfmathsetmacro\scale{1/100}
\pgfmathsetmacro\LayerDist{160}
\pgfmathsetmacro\THW{192 * \scale}
\pgfmathsetmacro\THWFactor{0.7}
\pgfmathsetmacro\TFirstLayer{3 * \scale}
\pgfmathsetmacro\TLayer{\TFirstLayer*(5+1/3)}
\pgfmathsetmacro\TLayerFactor{1.5}
\pgfmathsetmacro\XShift{100 * \scale}
\pgfmathsetmacro\YShift{0 * \scale}
\pgfmathsetmacro\ZShift{0 * \scale}

% first network part
\cube{\THW}{\TFirstLayer}{\THW}{\XShift}{\YShift}{\ZShift}{192}{192}{3}

\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV1}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift-0.005cm}{\ZShift}{96}{96}{16}
\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV2}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift-0.005cm}{\ZShift}{48}{48}{32}
\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV3}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift-0.003cm}{\ZShift}{24}{24}{64}
\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV4}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift+0.001cm}{\ZShift}{12}{12}{128}
\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV5}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{6}{6}{256}
\pgfmathsetmacro\XShiftInc{\TLayer + \LayerDist * \scale}

% add text
\node at ({\XShift+\XShiftInc/2},2.2,0) {\tiny{CONV6}};

\pgfmathsetmacro\THW{\THW*\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift+\THW/4}
\pgfmathsetmacro\ZShift{\ZShift+\THW/4}
\pgfmathsetmacro\TLayer{\TLayer*\TLayerFactor}

\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{3}{3}{512}

% concatenation
\pgfmathsetmacro\XShift{250 * \scale}
\pgfmathsetmacro\YShift{-500 * \scale}
\pgfmathsetmacro\ZShift{0}
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{3}{3}{512}
\pgfmathsetmacro\XShift{\XShift + \TLayer + 50 * \scale}
\node at ({\XShift+0.01cm},{\YShift+\THW/4},\ZShift) {\huge{$\oplus$}};
\node [label=above:\tiny{CONCAT}] at (\XShift,{\YShift+\THW/4+0.5},\ZShift) {};
\pgfmathsetmacro\XShift{\XShift + 50 * \scale}
\cube{\THW}{\TLayer}{\THW}{\XShift+0.02cm}{\YShift}{\ZShift}{3}{3}{512}
\coordinate (ZTL) at ({\XShift+\TLayer/2-0.1},-2.1);
\coordinate (ZBR) at ({\XShift+\TLayer/2+0.1},-3.1);
\draw [black,fill=\Thesiscolorbright] (ZTL) rectangle (ZBR);
\node [label={right:$z$}] at ( $ (ZTL)!0.5!(ZBR) $ ) {};
\node [label={left:\tiny{100}}] at ( $ (ZTL)!0.5!(ZBR) $ ) {};
\coordinate (ZBC) at ({\XShift+\TLayer/2},{(-2.8+\YShift)/2});
\node at (ZBC) {\huge{$\downarrow$}};
\node[label={right:\tiny{FULLY}}] at (ZBC) {};


% resizing
\node at ({0.02cm + \XShift + \TLayer + (200 * \scale)/2},{\YShift+\THW/4},\ZShift) {\huge{$\rightarrow$}};
\node [label=above:\tiny{RESIZE}] at ({0.02cm + \XShift + \TLayer + (200 * \scale)/2},{\YShift+\THW/4+0.5},\ZShift) {};
\pgfmathsetmacro\XShift{\XShift + \TLayer + 200 * \scale}
\pgfmathsetmacro\TLayer{\TLayer*2}
\pgfmathsetmacro\THW{(\THW * 4 * \THWFactor) / 3}
\cube{\THW}{\TLayer}{\THW}{\XShift+0.02cm}{\YShift}{\ZShift}{4}{4}{1024}


% second network part
\pgfmathsetmacro\XShift{0 * \scale}
\pgfmathsetmacro\YShift{\YShift - 300 * \scale}
\pgfmathsetmacro\ZShift{0}


\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{4}{4}{1024}

\pgfmathsetmacro\THW{\THW/\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.9 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift-\THW/4}
\pgfmathsetmacro\ZShift{\ZShift-\THW/4}
\pgfmathsetmacro\TLayer{\TLayer/\TLayerFactor}

% add text
\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV1}};
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{8}{8}{512}

\pgfmathsetmacro\THW{\THW/\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.9 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift-\THW/4}
\pgfmathsetmacro\ZShift{\ZShift-\THW/4}
\pgfmathsetmacro\TLayer{\TLayer/\TLayerFactor}

% add text
\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV2}};
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{16}{16}{256}

\pgfmathsetmacro\THW{\THW/\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.9 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift-\THW/4}
\pgfmathsetmacro\ZShift{\ZShift-\THW/4}
\pgfmathsetmacro\TLayer{\TLayer/\TLayerFactor}

% add text
\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV3}};
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{32}{32}{128}

\pgfmathsetmacro\THW{\THW/\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.9 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift-\THW/4}
\pgfmathsetmacro\ZShift{\ZShift-\THW/4}
\pgfmathsetmacro\TLayer{\TLayer/\TLayerFactor}

% add text
\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV4}};
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{64}{64}{64}

\pgfmathsetmacro\THW{\THW/\THWFactor}
\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.9 + \LayerDist * \scale}
\pgfmathsetmacro\YShift{\YShift-\THW/4}
\pgfmathsetmacro\ZShift{\ZShift-\THW/4}
\pgfmathsetmacro\TLayer{\TLayer/\TLayerFactor}

% add text
\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV5}};
\cube{\THW}{\TLayer}{\THW}{\XShift}{\YShift}{\ZShift}{64}{64}{32}

\pgfmathsetmacro\XShift{\XShift + \TLayer * 0.8 + \LayerDist * \scale + 0.5}
\pgfmathsetmacro\TLayer{3 * \scale}
\cube{\THW}{\TLayer}{\THW}{\XShift+0.005cm}{\YShift}{\ZShift}{64}{64}{3}

\pgfmathsetmacro\XShiftInc{\LayerDist * \scale / 2}
\node[anchor=base] at ({\XShift-\XShiftInc},-7,-0.5) {\tiny{TCONV6}};

% arrows
\draw[rounded corners=7pt, ->, thick](16,0.6) -- (17,0.6) -- (17,-1.5) -- (1,-1.5) -- (1,-4.95) -- (2,-4.95);
\draw[rounded corners=7pt, ->, thick](14.3,-4.95) -- (15.3,-4.95) -- (15.3,-6) -- (-1.5,-6) -- (-1.5,-8) -- (-0.5,-8);
\end{tikzpicture}